(()=>{"use strict";var e=document.querySelector(".elements");function t(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}var n={formSelector:".popup__input-container",inputSelector:".popup__input-item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__input-item_type_error",errorClass:"popup__input-item-error_active"};function o(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"ec7ecd53-86da-44fb-8b34-fdbecdd673ff","Content-Type":"application/json"}};function c(){return fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}var a=document.querySelector(".popup_edit-form"),u=document.querySelector(".popup_add-form"),i=document.querySelector(".popup_edit-avatar"),l=document.querySelector(".profile__avatar"),s=document.querySelector(".profile__name"),d=document.querySelector(".profile__bio"),f=a.querySelector("#name"),m=a.querySelector("#about"),p=u.querySelector("#title"),v=u.querySelector("#link"),h=i.querySelector("#avatarlink"),_=Array.from(a.querySelectorAll(n.inputSelector)),y=a.querySelector(n.submitButtonSelector),S=Array.from(u.querySelectorAll(n.inputSelector)),b=u.querySelector(n.submitButtonSelector),q=Array.from(i.querySelectorAll(n.inputSelector)),k=i.querySelector(n.submitButtonSelector);function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",j)}function E(e){var o=e.querySelector(n.formSelector);null!==o&&(o.reset(),o.querySelectorAll(n.inputSelector).forEach((function(e){t(o,e,n)})))}function g(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",j)}function L(e,t){e.textContent=t}function j(e){"Escape"===e.key&&g(document.querySelector(".popup_opened"))}var x,A=document.querySelector("#element-template").content,P=document.querySelector(".popup_open-image"),U=P.querySelector(".popup__view-image"),T=P.querySelector(".popup__view-caption");function B(e){var t=A.querySelector(".element").cloneNode(!0);t.querySelector(".element__title").textContent=e.name;var n=t.querySelector(".element__image");n.src=e.link,n.alt=e.name;var o=e.likes,c=o.length,a=t.querySelector(".element__like-counter");a.textContent=c;for(var u=t.querySelector(".element__like-button"),i=0;i<c;i++)if(o[i]._id===x){u.classList.add("element__like-button_active");break}u.addEventListener("click",(function(t){var n;t.target.classList.contains("element__like-button_active")?(n=e._id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))).then((function(e){a.textContent=e.likes.length,t.target.classList.remove("element__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}(e._id).then((function(e){a.textContent=e.likes.length,t.target.classList.add("element__like-button_active")})).catch((function(e){console.log(e)}))}));var l=t.querySelector(".element__trash-button");return l.addEventListener("click",(function(t){var n;(n=e._id,fetch("".concat(r.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))).then((function(e){t.target.closest(".element").remove()})).catch((function(e){console.log(e)}))})),e.owner._id!==x&&l.remove(),n.addEventListener("click",(function(t){U.src=e.link,T.textContent=e.name,U.alt=T.textContent,C(P)})),t}var w,D,N=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),J=document.querySelector(".profile__avatar-overlay");c().then((function(e){s.textContent=e.name,d.textContent=e.about,l.src=e.avatar})).catch((function(e){console.log(e)})),N.addEventListener("click",(function(){E(a),C(a),f.value=s.textContent,m.value=d.textContent,o(_,y,n)})),O.addEventListener("click",(function(){E(u),o(S,b,n),C(u)})),J.addEventListener("click",(function(){E(i),o(q,k,n),C(i)})),a.addEventListener("submit",(function(e){e.preventDefault(),L(y,"Сохранение..."),function(e,t){return fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}(f.value,m.value).then((function(e){s.textContent=e.name,d.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(e){L(y,"Сохранить"),g(a)}))})),u.addEventListener("submit",(function(t){var n,o;t.preventDefault(),L(b,"Создание..."),(n=p.value,o=v.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))).then((function(t){var n=B(t);e.prepend(n)})).catch((function(e){console.log(e)})).finally((function(e){L(b,"Создать"),g(u)}))})),i.addEventListener("submit",(function(e){var t;e.preventDefault(),L(k,"Сохранение..."),(t=h.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))).then((function(e){l.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(e){L(k,"Сохранить")})),g(i)})),Promise.all([fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})),c()]).then((function(t){var n=t[0],o=t[1];x=o._id;for(var r=0;r<n.length;r++){var c=B(n[r]);e.prepend(c)}})).catch((function(e){console.log(e)})),w=".popup",D=document.querySelectorAll(w),document.querySelectorAll(".popup__close-icon").forEach((function(e){e.addEventListener("click",(function(e){g(e.target.closest(w))}))})),D.forEach((function(e){e.addEventListener("click",(function(e){e.currentTarget===e.target&&g(e.currentTarget)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){!function(e,n){var r=Array.from(e.querySelectorAll(n.inputSelector)),c=e.querySelector(n.submitButtonSelector);o(r,c,n),r.forEach((function(a){a.addEventListener("input",(function(){!function(e,n,o){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?t(e,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,n,n.validationMessage,o)}(e,a,n),o(r,c,n)}))}))}(n,e)}))}(n)})();